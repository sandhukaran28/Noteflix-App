worker_processes  auto;
events { worker_connections 1024; }

http {
  include       mime.types;
  default_type  application/octet-stream;
  sendfile on;

  # gzip lists must be space-separated (NO COMMAS)
  gzip on;
  gzip_types text/plain application/json text/css application/javascript;

 server {
  listen 80;
  server_name _;

  # ---- OAuth routes -> FRONTEND (Next) ----
  location ^~ /api/auth/google/ {
    proxy_pass         http://noteflix-frontend:3000;
    proxy_set_header   Host $host;
    proxy_set_header   X-Forwarded-Proto $scheme;
    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Host $host;
    proxy_set_header   Cookie $http_cookie;
  }

  # (Optional) If you ever add other providers, catch all /api/auth/ with Next:
  # location ^~ /api/auth/ { ...same proxy to noteflix-frontend... }

  # ---- Your backend API ----
  location ^~ /api/v1/ {
    proxy_pass              http://noteflix:8080;
    proxy_http_version      1.1;
    proxy_set_header        Host $host;
    proxy_set_header        Connection "";
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        Authorization $http_authorization;
    proxy_set_header        Cookie $http_cookie;
    proxy_set_header        Range $http_range;
    proxy_set_header        If-Range $http_if_range;
    proxy_request_buffering off;
    proxy_buffering         off;
    proxy_read_timeout      600s;
    send_timeout            600s;
  }

  # ---- Everything else -> FRONTEND ----
  location / {
    proxy_pass         http://noteflix-frontend:3000;
    proxy_set_header   Host $host;
    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto $scheme;
  }
}
}
